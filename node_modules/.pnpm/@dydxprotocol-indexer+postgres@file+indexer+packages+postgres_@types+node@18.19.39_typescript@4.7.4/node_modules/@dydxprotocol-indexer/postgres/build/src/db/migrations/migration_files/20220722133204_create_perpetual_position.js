"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.down = exports.up = void 0;
async function up(knex) {
    return knex
        .schema
        .createTable('perpetual_positions', (table) => {
        table.uuid('id').primary();
        table.uuid('subaccountId').notNullable();
        table.bigInteger('perpetualId').notNullable();
        table.enum('side', [
            'LONG',
            'SHORT',
        ]).notNullable();
        table.enum('status', [
            'OPEN',
            'CLOSED',
            'LIQUIDATED',
        ]).notNullable();
        // The size of the position. Positive for long, negative for short.
        table.decimal('size', null).notNullable();
        table.decimal('maxSize', null).notNullable();
        table.decimal('entryPrice', null).notNullable();
        table.decimal('exitPrice', null).nullable();
        table.decimal('sumOpen', null).notNullable();
        table.decimal('sumClose', null).notNullable();
        table.timestamp('createdAt').notNullable();
        table.timestamp('closedAt').nullable();
        table.bigInteger('createdAtHeight').notNullable();
        table.bigInteger('closedAtHeight').nullable();
        table.binary('openEventId', 96).notNullable();
        table.binary('closeEventId', 96).nullable();
        table.binary('lastEventId', 96).notNullable();
        // This is the sum of all settled funding payments made to the subaccount. A positive value
        // indicates the subaccount received funding, negative indicates the subaccount paid funding.
        table.decimal('settledFunding', null).notNullable();
        // Foreign
        table.foreign('perpetualId').references('perpetual_markets.id');
        table.foreign('subaccountId').references('subaccounts.id');
        // Indices
        table.index(['subaccountId', 'status']);
        table.index(['subaccountId', 'createdAt']);
        table.index(['subaccountId', 'createdAtHeight']);
        table.index(['perpetualId', 'status']);
    });
}
exports.up = up;
async function down(knex) {
    return knex.schema.dropTableIfExists('perpetual_positions');
}
exports.down = down;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMjAyMjA3MjIxMzMyMDRfY3JlYXRlX3BlcnBldHVhbF9wb3NpdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9kYi9taWdyYXRpb25zL21pZ3JhdGlvbl9maWxlcy8yMDIyMDcyMjEzMzIwNF9jcmVhdGVfcGVycGV0dWFsX3Bvc2l0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUVPLEtBQUssVUFBVSxFQUFFLENBQUMsSUFBVTtJQUNqQyxPQUFPLElBQUk7U0FDUixNQUFNO1NBQ04sV0FBVyxDQUFDLHFCQUFxQixFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUU7UUFDNUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUMzQixLQUFLLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3pDLEtBQUssQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDOUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUU7WUFDakIsTUFBTTtZQUNOLE9BQU87U0FDUixDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDakIsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDbkIsTUFBTTtZQUNOLFFBQVE7WUFDUixZQUFZO1NBQ2IsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2pCLG1FQUFtRTtRQUNuRSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMxQyxLQUFLLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM3QyxLQUFLLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNoRCxLQUFLLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM1QyxLQUFLLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM3QyxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM5QyxLQUFLLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQzNDLEtBQUssQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDdkMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2xELEtBQUssQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM5QyxLQUFLLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxFQUFFLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM5QyxLQUFLLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM1QyxLQUFLLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxFQUFFLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUM5QywyRkFBMkY7UUFDM0YsNkZBQTZGO1FBQzdGLEtBQUssQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFcEQsVUFBVTtRQUNWLEtBQUssQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUMsVUFBVSxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFDaEUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUUzRCxVQUFVO1FBQ1YsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLGNBQWMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQ3hDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxjQUFjLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQztRQUMzQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsY0FBYyxFQUFFLGlCQUFpQixDQUFDLENBQUMsQ0FBQztRQUNqRCxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsYUFBYSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDekMsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBNUNELGdCQTRDQztBQUVNLEtBQUssVUFBVSxJQUFJLENBQUMsSUFBVTtJQUNuQyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUM5RCxDQUFDO0FBRkQsb0JBRUMifQ==