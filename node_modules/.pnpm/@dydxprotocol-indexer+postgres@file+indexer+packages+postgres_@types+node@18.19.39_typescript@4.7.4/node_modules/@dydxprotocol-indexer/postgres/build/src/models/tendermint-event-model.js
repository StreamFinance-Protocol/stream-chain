"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = __importDefault(require("path"));
const objection_1 = require("objection");
const validators_1 = require("../lib/validators");
class TendermintEventModel extends objection_1.Model {
    static get tableName() {
        return 'tendermint_events';
    }
    static get idColumn() {
        return 'id';
    }
    static get jsonSchema() {
        return {
            type: 'object',
            required: [
                'id',
                'blockHeight',
                'transactionIndex',
                'eventIndex',
            ],
            properties: {
                blockHeight: { type: 'string', pattern: validators_1.IntegerPattern },
                transactionIndex: { type: 'integer' },
                eventIndex: { type: 'integer' },
            },
        };
    }
}
exports.default = TendermintEventModel;
TendermintEventModel.relationMappings = {
    openPerpetualPosition: {
        relation: objection_1.Model.HasManyRelation,
        modelClass: path_1.default.join(__dirname, 'perpetual-position-model'),
        join: {
            from: 'tendermint_events.id',
            to: 'perpetual_positions.openEventId',
        },
    },
    closePerpetualPosition: {
        relation: objection_1.Model.HasManyRelation,
        modelClass: path_1.default.join(__dirname, 'perpetual-position-model'),
        join: {
            from: 'tendermint_events.id',
            to: 'perpetual_positions.closeEventId',
        },
    },
    lastPerpetualPosition: {
        relation: objection_1.Model.HasManyRelation,
        modelClass: path_1.default.join(__dirname, 'perpetual-position-model'),
        join: {
            from: 'tendermint_events.id',
            to: 'perpetual_positions.lastEventId',
        },
    },
    fills: {
        relation: objection_1.Model.HasManyRelation,
        modelClass: path_1.default.join(__dirname, 'fill-model'),
        join: {
            from: 'tendermint_events.id',
            to: 'fills.eventId',
        },
    },
    blocks: {
        relation: objection_1.Model.BelongsToOneRelation,
        modelClass: path_1.default.join(__dirname, 'block-model'),
        join: {
            from: 'tendermint_events.blockHeight',
            to: 'blocks.blockHeight',
        },
    },
    transfers: {
        relation: objection_1.Model.HasManyRelation,
        modelClass: path_1.default.join(__dirname, 'transfer-model'),
        join: {
            from: 'tendermint_events.id',
            to: 'transfers.eventId',
        },
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVuZGVybWludC1ldmVudC1tb2RlbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tb2RlbHMvdGVuZGVybWludC1ldmVudC1tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLGdEQUF3QjtBQUV4Qix5Q0FBa0M7QUFFbEMsa0RBQW1EO0FBRW5ELE1BQXFCLG9CQUFxQixTQUFRLGlCQUFLO0lBQ3JELE1BQU0sS0FBSyxTQUFTO1FBQ2xCLE9BQU8sbUJBQW1CLENBQUM7SUFDN0IsQ0FBQztJQUVELE1BQU0sS0FBSyxRQUFRO1FBQ2pCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQXFERCxNQUFNLEtBQUssVUFBVTtRQUNuQixPQUFPO1lBQ0wsSUFBSSxFQUFFLFFBQVE7WUFDZCxRQUFRLEVBQUU7Z0JBQ1IsSUFBSTtnQkFDSixhQUFhO2dCQUNiLGtCQUFrQjtnQkFDbEIsWUFBWTthQUNiO1lBQ0QsVUFBVSxFQUFFO2dCQUNWLFdBQVcsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLDJCQUFjLEVBQUU7Z0JBQ3hELGdCQUFnQixFQUFFLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRTtnQkFDckMsVUFBVSxFQUFFLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRTthQUNoQztTQUNGLENBQUM7SUFDSixDQUFDOztBQTNFSCx1Q0FvRkM7QUEzRVEscUNBQWdCLEdBQUc7SUFDeEIscUJBQXFCLEVBQUU7UUFDckIsUUFBUSxFQUFFLGlCQUFLLENBQUMsZUFBZTtRQUMvQixVQUFVLEVBQUUsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsMEJBQTBCLENBQUM7UUFDNUQsSUFBSSxFQUFFO1lBQ0osSUFBSSxFQUFFLHNCQUFzQjtZQUM1QixFQUFFLEVBQUUsaUNBQWlDO1NBQ3RDO0tBQ0Y7SUFDRCxzQkFBc0IsRUFBRTtRQUN0QixRQUFRLEVBQUUsaUJBQUssQ0FBQyxlQUFlO1FBQy9CLFVBQVUsRUFBRSxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSwwQkFBMEIsQ0FBQztRQUM1RCxJQUFJLEVBQUU7WUFDSixJQUFJLEVBQUUsc0JBQXNCO1lBQzVCLEVBQUUsRUFBRSxrQ0FBa0M7U0FDdkM7S0FDRjtJQUNELHFCQUFxQixFQUFFO1FBQ3JCLFFBQVEsRUFBRSxpQkFBSyxDQUFDLGVBQWU7UUFDL0IsVUFBVSxFQUFFLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLDBCQUEwQixDQUFDO1FBQzVELElBQUksRUFBRTtZQUNKLElBQUksRUFBRSxzQkFBc0I7WUFDNUIsRUFBRSxFQUFFLGlDQUFpQztTQUN0QztLQUNGO0lBQ0QsS0FBSyxFQUFFO1FBQ0wsUUFBUSxFQUFFLGlCQUFLLENBQUMsZUFBZTtRQUMvQixVQUFVLEVBQUUsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDO1FBQzlDLElBQUksRUFBRTtZQUNKLElBQUksRUFBRSxzQkFBc0I7WUFDNUIsRUFBRSxFQUFFLGVBQWU7U0FDcEI7S0FDRjtJQUNELE1BQU0sRUFBRTtRQUNOLFFBQVEsRUFBRSxpQkFBSyxDQUFDLG9CQUFvQjtRQUNwQyxVQUFVLEVBQUUsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsYUFBYSxDQUFDO1FBQy9DLElBQUksRUFBRTtZQUNKLElBQUksRUFBRSwrQkFBK0I7WUFDckMsRUFBRSxFQUFFLG9CQUFvQjtTQUN6QjtLQUNGO0lBQ0QsU0FBUyxFQUFFO1FBQ1QsUUFBUSxFQUFFLGlCQUFLLENBQUMsZUFBZTtRQUMvQixVQUFVLEVBQUUsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsZ0JBQWdCLENBQUM7UUFDbEQsSUFBSSxFQUFFO1lBQ0osSUFBSSxFQUFFLHNCQUFzQjtZQUM1QixFQUFFLEVBQUUsbUJBQW1CO1NBQ3hCO0tBQ0Y7Q0FDRixDQUFDIn0=