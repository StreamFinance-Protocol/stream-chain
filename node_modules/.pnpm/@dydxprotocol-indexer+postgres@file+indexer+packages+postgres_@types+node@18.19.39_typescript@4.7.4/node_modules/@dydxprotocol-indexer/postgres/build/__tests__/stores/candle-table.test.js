"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const CandleTable = __importStar(require("../../src/stores/candle-table"));
const db_helpers_1 = require("../../src/helpers/db-helpers");
const constants_1 = require("../helpers/constants");
describe('CandleTable', () => {
    afterEach(async () => {
        await (0, db_helpers_1.clearData)();
    });
    afterAll(async () => {
        await (0, db_helpers_1.teardown)();
    });
    it('Successfully creates a Candle', async () => {
        await CandleTable.create(constants_1.defaultCandle);
    });
    it('Successfully finds all Candles', async () => {
        await Promise.all([
            CandleTable.create(constants_1.defaultCandle),
            CandleTable.create({
                ...constants_1.defaultCandle,
                ticker: constants_1.defaultPerpetualMarket2.ticker,
            }),
        ]);
        const candles = await CandleTable.findAll({}, [], { readReplica: true });
        expect(candles.length).toEqual(2);
        expect(candles[0]).toEqual(expect.objectContaining({
            ...constants_1.defaultCandle,
            ticker: constants_1.defaultPerpetualMarket2.ticker,
        }));
        expect(candles[1]).toEqual(expect.objectContaining(constants_1.defaultCandle));
    });
    it('Successfully finds a Candle', async () => {
        await CandleTable.create(constants_1.defaultCandle);
        const candle = await CandleTable.findById(constants_1.defaultCandleId);
        expect(candle).toEqual(expect.objectContaining(constants_1.defaultCandle));
    });
    it('Fails to finds a nonexistent Candle', async () => {
        const candle = await CandleTable.findById(constants_1.defaultCandleId);
        expect(candle).toEqual(undefined);
    });
    it('Successfully updates a candle', async () => {
        await CandleTable.create(constants_1.defaultCandle);
        const updatedCandle = {
            id: constants_1.defaultCandleId,
            open: '100',
        };
        await CandleTable.update({
            id: constants_1.defaultCandleId,
            open: '100',
        });
        const candle = await CandleTable.findById(constants_1.defaultCandleId);
        expect(candle).toEqual(expect.objectContaining(updatedCandle));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FuZGxlLXRhYmxlLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9fX3Rlc3RzX18vc3RvcmVzL2NhbmRsZS10YWJsZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQSwyRUFBNkQ7QUFDN0QsNkRBR3NDO0FBQ3RDLG9EQUErRjtBQUUvRixRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtJQUMzQixTQUFTLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsTUFBTSxJQUFBLHNCQUFTLEdBQUUsQ0FBQztJQUNwQixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNsQixNQUFNLElBQUEscUJBQVEsR0FBRSxDQUFDO0lBQ25CLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLCtCQUErQixFQUFFLEtBQUssSUFBSSxFQUFFO1FBQzdDLE1BQU0sV0FBVyxDQUFDLE1BQU0sQ0FBQyx5QkFBYSxDQUFDLENBQUM7SUFDMUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDOUMsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDO1lBQ2hCLFdBQVcsQ0FBQyxNQUFNLENBQUMseUJBQWEsQ0FBQztZQUNqQyxXQUFXLENBQUMsTUFBTSxDQUFDO2dCQUNqQixHQUFHLHlCQUFhO2dCQUNoQixNQUFNLEVBQUUsbUNBQXVCLENBQUMsTUFBTTthQUN2QyxDQUFDO1NBQ0gsQ0FBQyxDQUFDO1FBRUgsTUFBTSxPQUFPLEdBQXlCLE1BQU0sV0FBVyxDQUFDLE9BQU8sQ0FDN0QsRUFBRSxFQUNGLEVBQUUsRUFDRixFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsQ0FDdEIsQ0FBQztRQUVGLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDO1lBQ2pELEdBQUcseUJBQWE7WUFDaEIsTUFBTSxFQUFFLG1DQUF1QixDQUFDLE1BQU07U0FDdkMsQ0FBQyxDQUFDLENBQUM7UUFDSixNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyx5QkFBYSxDQUFDLENBQUMsQ0FBQztJQUNyRSxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyw2QkFBNkIsRUFBRSxLQUFLLElBQUksRUFBRTtRQUMzQyxNQUFNLFdBQVcsQ0FBQyxNQUFNLENBQUMseUJBQWEsQ0FBQyxDQUFDO1FBRXhDLE1BQU0sTUFBTSxHQUFtQyxNQUFNLFdBQVcsQ0FBQyxRQUFRLENBQ3ZFLDJCQUFlLENBQ2hCLENBQUM7UUFFRixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyx5QkFBYSxDQUFDLENBQUMsQ0FBQztJQUNqRSxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRSxLQUFLLElBQUksRUFBRTtRQUNuRCxNQUFNLE1BQU0sR0FBbUMsTUFBTSxXQUFXLENBQUMsUUFBUSxDQUN2RSwyQkFBZSxDQUNoQixDQUFDO1FBQ0YsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNwQyxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQywrQkFBK0IsRUFBRSxLQUFLLElBQUksRUFBRTtRQUM3QyxNQUFNLFdBQVcsQ0FBQyxNQUFNLENBQUMseUJBQWEsQ0FBQyxDQUFDO1FBRXhDLE1BQU0sYUFBYSxHQUF1QjtZQUN4QyxFQUFFLEVBQUUsMkJBQWU7WUFDbkIsSUFBSSxFQUFFLEtBQUs7U0FDWixDQUFDO1FBRUYsTUFBTSxXQUFXLENBQUMsTUFBTSxDQUFDO1lBQ3ZCLEVBQUUsRUFBRSwyQkFBZTtZQUNuQixJQUFJLEVBQUUsS0FBSztTQUNaLENBQUMsQ0FBQztRQUVILE1BQU0sTUFBTSxHQUFtQyxNQUFNLFdBQVcsQ0FBQyxRQUFRLENBQ3ZFLDJCQUFlLENBQ2hCLENBQUM7UUFFRixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO0lBQ2pFLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMifQ==