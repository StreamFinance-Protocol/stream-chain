"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = __importDefault(require("path"));
const objection_1 = require("objection");
const base_model_1 = __importDefault(require("./base-model"));
class SubaccountModel extends base_model_1.default {
    static get tableName() {
        return 'subaccounts';
    }
    static get idColumn() {
        return 'id';
    }
    static get jsonSchema() {
        return {
            type: 'object',
            required: [
                'id',
                'address',
                'subaccountNumber',
                'updatedAt',
                'updatedAtHeight',
            ],
            properties: {
                id: { type: 'string', format: 'uuid' },
                address: { type: 'string' },
                subaccountNumber: { type: 'integer' },
                updatedAt: { type: 'string', format: 'date-time' },
                updatedAtHeight: { type: 'string' },
            },
        };
    }
    /**
     * A mapping from column name to JSON conversion expected.
     * See getSqlConversionForDydxModelTypes for valid conversions.
     *
     * TODO(IND-239): Ensure that jsonSchema() / sqlToJsonConversions() / model fields match.
     */
    static get sqlToJsonConversions() {
        return {
            id: 'string',
            address: 'string',
            subaccountNumber: 'integer',
            updatedAt: 'date-time',
            updatedAtHeight: 'string',
        };
    }
}
exports.default = SubaccountModel;
SubaccountModel.relationMappings = {
    orders: {
        relation: objection_1.Model.HasManyRelation,
        modelClass: path_1.default.join(__dirname, 'order-model'),
        join: {
            from: 'subaccounts.id',
            to: 'orders.subaccountId',
        },
    },
    height: {
        relation: objection_1.Model.HasManyRelation,
        modelClass: path_1.default.join(__dirname, 'block-model'),
        join: {
            from: 'subaccounts.updatedAtHeight',
            to: 'blocks.blockHeight',
        },
    },
    perpetualPositions: {
        relation: objection_1.Model.HasManyRelation,
        modelClass: path_1.default.join(__dirname, 'perpetual-position-model'),
        join: {
            from: 'subaccounts.id',
            to: 'perpetual_positions.subaccountId',
        },
    },
    fills: {
        relation: objection_1.Model.HasManyRelation,
        modelClass: path_1.default.join(__dirname, 'fill-model'),
        join: {
            from: 'subaccounts.id',
            to: 'fills.subaccountId',
        },
    },
    assetPosition: {
        relation: objection_1.Model.HasManyRelation,
        modelClass: path_1.default.join(__dirname, 'asset-position-model'),
        join: {
            from: 'subaccounts.id',
            to: 'asset_positions.subaccountId',
        },
    },
    fromTransfer: {
        relation: objection_1.Model.HasManyRelation,
        modelClass: path_1.default.join(__dirname, 'transfer-model'),
        join: {
            from: 'subaccounts.id',
            to: 'transfers.senderSubaccountId',
        },
    },
    toTransfer: {
        relation: objection_1.Model.HasManyRelation,
        modelClass: path_1.default.join(__dirname, 'transfer-model'),
        join: {
            from: 'subaccounts.id',
            to: 'transfers.recipientSubaccountId',
        },
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ViYWNjb3VudC1tb2RlbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tb2RlbHMvc3ViYWNjb3VudC1tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLGdEQUF3QjtBQUV4Qix5Q0FBa0M7QUFJbEMsOERBQXFDO0FBRXJDLE1BQXFCLGVBQWdCLFNBQVEsb0JBQVM7SUFDcEQsTUFBTSxLQUFLLFNBQVM7UUFDbEIsT0FBTyxhQUFhLENBQUM7SUFDdkIsQ0FBQztJQUVELE1BQU0sS0FBSyxRQUFRO1FBQ2pCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQTZERCxNQUFNLEtBQUssVUFBVTtRQUNuQixPQUFPO1lBQ0wsSUFBSSxFQUFFLFFBQVE7WUFDZCxRQUFRLEVBQUU7Z0JBQ1IsSUFBSTtnQkFDSixTQUFTO2dCQUNULGtCQUFrQjtnQkFDbEIsV0FBVztnQkFDWCxpQkFBaUI7YUFDbEI7WUFDRCxVQUFVLEVBQUU7Z0JBQ1YsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFO2dCQUN0QyxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFO2dCQUMzQixnQkFBZ0IsRUFBRSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUU7Z0JBQ3JDLFNBQVMsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRTtnQkFDbEQsZUFBZSxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRTthQUNwQztTQUNGLENBQUM7SUFDSixDQUFDO0lBRUQ7Ozs7O09BS0c7SUFDSCxNQUFNLEtBQUssb0JBQW9CO1FBQzdCLE9BQU87WUFDTCxFQUFFLEVBQUUsUUFBUTtZQUNaLE9BQU8sRUFBRSxRQUFRO1lBQ2pCLGdCQUFnQixFQUFFLFNBQVM7WUFDM0IsU0FBUyxFQUFFLFdBQVc7WUFDdEIsZUFBZSxFQUFFLFFBQVE7U0FDMUIsQ0FBQztJQUNKLENBQUM7O0FBdEdILGtDQW1IQztBQTFHUSxnQ0FBZ0IsR0FBRztJQUN4QixNQUFNLEVBQUU7UUFDTixRQUFRLEVBQUUsaUJBQUssQ0FBQyxlQUFlO1FBQy9CLFVBQVUsRUFBRSxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxhQUFhLENBQUM7UUFDL0MsSUFBSSxFQUFFO1lBQ0osSUFBSSxFQUFFLGdCQUFnQjtZQUN0QixFQUFFLEVBQUUscUJBQXFCO1NBQzFCO0tBQ0Y7SUFDRCxNQUFNLEVBQUU7UUFDTixRQUFRLEVBQUUsaUJBQUssQ0FBQyxlQUFlO1FBQy9CLFVBQVUsRUFBRSxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxhQUFhLENBQUM7UUFDL0MsSUFBSSxFQUFFO1lBQ0osSUFBSSxFQUFFLDZCQUE2QjtZQUNuQyxFQUFFLEVBQUUsb0JBQW9CO1NBQ3pCO0tBQ0Y7SUFDRCxrQkFBa0IsRUFBRTtRQUNsQixRQUFRLEVBQUUsaUJBQUssQ0FBQyxlQUFlO1FBQy9CLFVBQVUsRUFBRSxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSwwQkFBMEIsQ0FBQztRQUM1RCxJQUFJLEVBQUU7WUFDSixJQUFJLEVBQUUsZ0JBQWdCO1lBQ3RCLEVBQUUsRUFBRSxrQ0FBa0M7U0FDdkM7S0FDRjtJQUNELEtBQUssRUFBRTtRQUNMLFFBQVEsRUFBRSxpQkFBSyxDQUFDLGVBQWU7UUFDL0IsVUFBVSxFQUFFLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQztRQUM5QyxJQUFJLEVBQUU7WUFDSixJQUFJLEVBQUUsZ0JBQWdCO1lBQ3RCLEVBQUUsRUFBRSxvQkFBb0I7U0FDekI7S0FDRjtJQUNELGFBQWEsRUFBRTtRQUNiLFFBQVEsRUFBRSxpQkFBSyxDQUFDLGVBQWU7UUFDL0IsVUFBVSxFQUFFLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLHNCQUFzQixDQUFDO1FBQ3hELElBQUksRUFBRTtZQUNKLElBQUksRUFBRSxnQkFBZ0I7WUFDdEIsRUFBRSxFQUFFLDhCQUE4QjtTQUNuQztLQUNGO0lBQ0QsWUFBWSxFQUFFO1FBQ1osUUFBUSxFQUFFLGlCQUFLLENBQUMsZUFBZTtRQUMvQixVQUFVLEVBQUUsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsZ0JBQWdCLENBQUM7UUFDbEQsSUFBSSxFQUFFO1lBQ0osSUFBSSxFQUFFLGdCQUFnQjtZQUN0QixFQUFFLEVBQUUsOEJBQThCO1NBQ25DO0tBQ0Y7SUFDRCxVQUFVLEVBQUU7UUFDVixRQUFRLEVBQUUsaUJBQUssQ0FBQyxlQUFlO1FBQy9CLFVBQVUsRUFBRSxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxnQkFBZ0IsQ0FBQztRQUNsRCxJQUFJLEVBQUU7WUFDSixJQUFJLEVBQUUsZ0JBQWdCO1lBQ3RCLEVBQUUsRUFBRSxpQ0FBaUM7U0FDdEM7S0FDRjtDQUNGLENBQUMifQ==