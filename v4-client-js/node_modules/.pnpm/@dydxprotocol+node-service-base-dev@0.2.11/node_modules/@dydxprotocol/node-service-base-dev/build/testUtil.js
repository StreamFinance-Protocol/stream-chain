"use strict";
/**
 * Utilities for writing unit tests with jest.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.mockNow = exports.asMock = exports.advancePromiseQueue = void 0;
/**
 * Allow pending jobs in Node's PromiseJobs queue to run.
 *
 * May be needed when testing tasks triggered by timers.
 *
 * See https://stackoverflow.com/questions/52177631/jest-timer-and-promise-dont-work-well-settimeout-and-async-function
 */
async function advancePromiseQueue(n = 1) {
    for (let i = 0; i < n; i += 1) {
        await Promise.resolve();
    }
}
exports.advancePromiseQueue = advancePromiseQueue;
function asMock(mock) {
    if (typeof mock === 'function') {
        return mock;
    }
    return mock;
}
exports.asMock = asMock;
/**
 * Mock the value returned by Date.now().
 */
function mockNow(now) {
    const nowMs = new Date(now).getTime();
    jest.spyOn(Date, 'now').mockImplementation(() => nowMs);
    return asMock(Date.now);
}
exports.mockNow = mockNow;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdFV0aWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdGVzdFV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOzs7QUFlSDs7Ozs7O0dBTUc7QUFDSSxLQUFLLFVBQVUsbUJBQW1CLENBQUMsSUFBWSxDQUFDO0lBQ3JELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUM3QixNQUFNLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztLQUN6QjtBQUNILENBQUM7QUFKRCxrREFJQztBQU9ELFNBQWdCLE1BQU0sQ0FBQyxJQUFpQjtJQUN0QyxJQUFJLE9BQU8sSUFBSSxLQUFLLFVBQVUsRUFBRTtRQUM5QixPQUFPLElBQTJCLENBQUM7S0FDcEM7SUFDRCxPQUFPLElBQStCLENBQUM7QUFDekMsQ0FBQztBQUxELHdCQUtDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixPQUFPLENBQUMsR0FBa0I7SUFDeEMsTUFBTSxLQUFLLEdBQVcsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDOUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDeEQsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQzFCLENBQUM7QUFKRCwwQkFJQyJ9