"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.formatAlterTableEnumSql = void 0;
// copied from this answer: https://github.com/knex/knex/issues/1699
// Generates raw SQL to updating check constraints on an enum column with minimal locking.
function formatAlterTableEnumSql(tableName, columnName, enums) {
    const constraintName = `${tableName}_${columnName}_check`;
    return [
        `ALTER TABLE "${tableName}" DROP CONSTRAINT IF EXISTS "${constraintName}";`,
        `ALTER TABLE "${tableName}" ADD CONSTRAINT "${constraintName}" CHECK ("${columnName}" = ANY (ARRAY['${enums.join('\'::text, \'')}'::text])) NOT VALID;`,
    ].join('\n');
}
exports.formatAlterTableEnumSql = formatAlterTableEnumSql;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9kYi9taWdyYXRpb25zL2hlbHBlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsb0VBQW9FO0FBQ3BFLDBGQUEwRjtBQUMxRixTQUFnQix1QkFBdUIsQ0FDckMsU0FBaUIsRUFDakIsVUFBa0IsRUFDbEIsS0FBZTtJQUVmLE1BQU0sY0FBYyxHQUFHLEdBQUcsU0FBUyxJQUFJLFVBQVUsUUFBUSxDQUFDO0lBQzFELE9BQU87UUFDTCxnQkFBZ0IsU0FBUyxnQ0FBZ0MsY0FBYyxJQUFJO1FBQzNFLGdCQUFnQixTQUFTLHFCQUFxQixjQUFjLGFBQWEsVUFBVSxtQkFBbUIsS0FBSyxDQUFDLElBQUksQ0FDOUcsY0FBYyxDQUNmLHVCQUF1QjtLQUN6QixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNmLENBQUM7QUFaRCwwREFZQyJ9