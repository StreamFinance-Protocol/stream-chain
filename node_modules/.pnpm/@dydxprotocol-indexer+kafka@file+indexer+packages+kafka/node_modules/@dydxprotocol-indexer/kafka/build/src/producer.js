"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.disconnect = exports.producer = void 0;
const base_1 = require("@dydxprotocol-indexer/base");
const kafkajs_1 = require("kafkajs");
const kafka_1 = require("./kafka");
exports.producer = kafka_1.kafka.producer({
    createPartitioner: kafkajs_1.Partitioners.DefaultPartitioner,
});
let stopped = false;
exports.producer.on('producer.disconnect', async () => {
    base_1.logger.info({
        at: 'kafka-producer#disconnect',
        message: 'Kafka producer disconnected',
    });
    if (!stopped) {
        await exports.producer.connect();
        base_1.logger.info({
            at: 'kafka-producer#disconnect',
            message: 'Kafka producer reconnected',
        });
    }
});
async function disconnect() {
    stopped = true;
    await exports.producer.disconnect();
}
exports.disconnect = disconnect;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvcHJvZHVjZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEscURBQW9EO0FBQ3BELHFDQUFpRDtBQUVqRCxtQ0FBZ0M7QUFFbkIsUUFBQSxRQUFRLEdBQWEsYUFBSyxDQUFDLFFBQVEsQ0FBQztJQUMvQyxpQkFBaUIsRUFBRSxzQkFBWSxDQUFDLGtCQUFrQjtDQUNuRCxDQUFDLENBQUM7QUFFSCxJQUFJLE9BQU8sR0FBWSxLQUFLLENBQUM7QUFFN0IsZ0JBQVEsQ0FBQyxFQUFFLENBQUMscUJBQXFCLEVBQUUsS0FBSyxJQUFJLEVBQUU7SUFDNUMsYUFBTSxDQUFDLElBQUksQ0FBQztRQUNWLEVBQUUsRUFBRSwyQkFBMkI7UUFDL0IsT0FBTyxFQUFFLDZCQUE2QjtLQUN2QyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMsT0FBTyxFQUFFO1FBQ1osTUFBTSxnQkFBUSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRXpCLGFBQU0sQ0FBQyxJQUFJLENBQUM7WUFDVixFQUFFLEVBQUUsMkJBQTJCO1lBQy9CLE9BQU8sRUFBRSw0QkFBNEI7U0FDdEMsQ0FBQyxDQUFDO0tBQ0o7QUFDSCxDQUFDLENBQUMsQ0FBQztBQUVJLEtBQUssVUFBVSxVQUFVO0lBQzlCLE9BQU8sR0FBRyxJQUFJLENBQUM7SUFDZixNQUFNLGdCQUFRLENBQUMsVUFBVSxFQUFFLENBQUM7QUFDOUIsQ0FBQztBQUhELGdDQUdDIn0=