"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.findById = exports.create = exports.getNetTransfersPerSubaccount = exports.getNetTransfersBetweenBlockHeightsForSubaccount = exports.findAllToOrFromSubaccountId = exports.findAll = exports.uuid = void 0;
const big_js_1 = __importDefault(require("big.js"));
const lodash_1 = __importDefault(require("lodash"));
const constants_1 = require("../constants");
const stores_helpers_1 = require("../helpers/stores-helpers");
const transaction_1 = __importDefault(require("../helpers/transaction"));
const uuid_1 = require("../helpers/uuid");
const transfer_model_1 = __importDefault(require("../models/transfer-model"));
const types_1 = require("../types");
function uuid(eventId, assetId, senderSubaccountId, recipientSubaccountId, senderWalletAddress, recipientWalletAddress) {
    // TODO(IND-483): Fix all uuid string substitutions to use Array.join.
    return (0, uuid_1.getUuid)(Buffer.from(`${senderSubaccountId}-${recipientSubaccountId}-${senderWalletAddress}-${recipientWalletAddress}-${eventId.toString('hex')}-${assetId}`, constants_1.BUFFER_ENCODING_UTF_8));
}
exports.uuid = uuid;
async function findAll({ limit, id, senderSubaccountId, recipientSubaccountId, senderWalletAddress, recipientWalletAddress, assetId, size, eventId, transactionHash, createdAt, createdAtHeight, createdBeforeOrAtHeight, createdBeforeOrAt, createdAfter, createdAfterHeight, }, requiredFields, options = constants_1.DEFAULT_POSTGRES_OPTIONS) {
    (0, stores_helpers_1.verifyAllRequiredFields)({
        limit,
        id,
        senderSubaccountId,
        recipientSubaccountId,
        senderWalletAddress,
        recipientWalletAddress,
        assetId,
        size,
        eventId,
        transactionHash,
        createdAt,
        createdAtHeight,
        createdBeforeOrAtHeight,
        createdBeforeOrAt,
        createdAfter,
        createdAfterHeight,
    }, requiredFields);
    let baseQuery = (0, stores_helpers_1.setupBaseQuery)(transfer_model_1.default, options);
    if (id !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.id, id);
    }
    if (senderSubaccountId !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.senderSubaccountId, senderSubaccountId);
    }
    if (recipientSubaccountId !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.recipientSubaccountId, recipientSubaccountId);
    }
    if (senderWalletAddress !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.senderWalletAddress, senderWalletAddress);
    }
    if (recipientWalletAddress !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.recipientWalletAddress, recipientWalletAddress);
    }
    if (assetId !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.assetId, assetId);
    }
    if (size !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.size, size);
    }
    if (eventId !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.eventId, eventId);
    }
    if (transactionHash !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.transactionHash, transactionHash);
    }
    if (createdAt !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.createdAt, createdAt);
    }
    if (createdAtHeight !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.createdAtHeight, createdAtHeight);
    }
    if (createdBeforeOrAtHeight !== undefined) {
        baseQuery = baseQuery.where(types_1.TransferColumns.createdAtHeight, '<=', createdBeforeOrAtHeight);
    }
    if (createdBeforeOrAt !== undefined) {
        baseQuery = baseQuery.where(types_1.TransferColumns.createdAt, '<=', createdBeforeOrAt);
    }
    if (createdAfterHeight !== undefined) {
        baseQuery = baseQuery.where(types_1.TransferColumns.createdAtHeight, '>', createdAfterHeight);
    }
    if (createdAfter !== undefined) {
        baseQuery = baseQuery.where(types_1.TransferColumns.createdAt, '>', createdAfter);
    }
    if (options.orderBy !== undefined) {
        for (const [column, order] of options.orderBy) {
            baseQuery = baseQuery.orderBy(column, order);
        }
    }
    if (limit !== undefined) {
        baseQuery = baseQuery.limit(limit);
    }
    return baseQuery.returning('*');
}
exports.findAll = findAll;
// finds all transfers to or from the subaccount id
async function findAllToOrFromSubaccountId({ limit, id, subaccountId, assetId, size, eventId, transactionHash, createdAt, createdAtHeight, createdBeforeOrAtHeight, createdBeforeOrAt, createdAfterHeight, createdAfter, }, requiredFields, options = constants_1.DEFAULT_POSTGRES_OPTIONS) {
    (0, stores_helpers_1.verifyAllRequiredFields)({
        limit,
        id,
        subaccountId,
        assetId,
        size,
        eventId,
        transactionHash,
        createdAt,
        createdAtHeight,
        createdBeforeOrAtHeight,
        createdBeforeOrAt,
        createdAfterHeight,
        createdAfter,
    }, requiredFields);
    let baseQuery = (0, stores_helpers_1.setupBaseQuery)(transfer_model_1.default, options);
    if (id !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.id, id);
    }
    if (subaccountId !== undefined) {
        baseQuery = baseQuery.where((queryBuilder) => {
            // eslint-disable-next-line no-void
            void queryBuilder.whereIn(types_1.TransferColumns.recipientSubaccountId, subaccountId)
                .orWhereIn(types_1.TransferColumns.senderSubaccountId, subaccountId);
        });
    }
    if (assetId !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.assetId, assetId);
    }
    if (size !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.size, size);
    }
    if (eventId !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.eventId, eventId);
    }
    if (transactionHash !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.transactionHash, transactionHash);
    }
    if (createdAt !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.createdAt, createdAt);
    }
    if (createdAtHeight !== undefined) {
        baseQuery = baseQuery.whereIn(types_1.TransferColumns.createdAtHeight, createdAtHeight);
    }
    if (createdBeforeOrAtHeight !== undefined) {
        baseQuery = baseQuery.where(types_1.TransferColumns.createdAtHeight, '<=', createdBeforeOrAtHeight);
    }
    if (createdBeforeOrAt !== undefined) {
        baseQuery = baseQuery.where(types_1.TransferColumns.createdAt, '<=', createdBeforeOrAt);
    }
    if (createdAfterHeight !== undefined) {
        baseQuery = baseQuery.where(types_1.TransferColumns.createdAtHeight, '>', createdAfterHeight);
    }
    if (createdAfter !== undefined) {
        baseQuery = baseQuery.where(types_1.TransferColumns.createdAt, '>', createdAfter);
    }
    if (options.orderBy !== undefined) {
        for (const [column, order] of options.orderBy) {
            baseQuery = baseQuery.orderBy(column, order);
        }
    }
    if (limit !== undefined) {
        baseQuery = baseQuery.limit(limit);
    }
    return baseQuery.returning('*');
}
exports.findAllToOrFromSubaccountId = findAllToOrFromSubaccountId;
function convertToSubaccountAssetMap(transfers) {
    const assetGroups = lodash_1.default.groupBy(transfers, 'subaccountId');
    return lodash_1.default.mapValues(assetGroups, (group) => {
        return lodash_1.default.reduce(group, (result, asset) => {
            return { ...result, [asset.assetId]: asset.totalSize };
        }, {});
    });
}
async function getNetTransfersBetweenBlockHeightsForSubaccount(subaccountId, createdAfterHeight, createdBeforeOrAtHeight, options = constants_1.DEFAULT_POSTGRES_OPTIONS) {
    const queryString = `
    SELECT 
      "assetId",
      SUM(
        CASE 
          WHEN "senderSubaccountId" = '${subaccountId}' THEN -"size"
          ELSE "size"
        END
      ) AS "totalSize"
    FROM 
      "transfers"
    WHERE 
      (
        "senderSubaccountId" = '${subaccountId}' 
        OR "recipientSubaccountId" = '${subaccountId}'
      )
      AND "createdAtHeight" > ${createdAfterHeight} 
      AND "createdAtHeight" <= ${createdBeforeOrAtHeight}
    GROUP BY 
      "assetId";
  `;
    const result = await (0, stores_helpers_1.rawQuery)(queryString, options);
    return lodash_1.default.mapValues(lodash_1.default.keyBy(result.rows, 'assetId'), (row) => {
        return (0, big_js_1.default)(row.totalSize);
    });
}
exports.getNetTransfersBetweenBlockHeightsForSubaccount = getNetTransfersBetweenBlockHeightsForSubaccount;
async function getNetTransfersPerSubaccount(createdBeforeOrAtHeight, options = constants_1.DEFAULT_POSTGRES_OPTIONS) {
    // Get the net value of transfers since beginning of time up until createdBeforeOrAtHeight
    // for all subaccounts. If a subaccount is sending an asset, the value will be negative.
    // If a subaccount is receiving an asset, the value will be positive.
    const queryString = `
  SELECT 
    sub."subaccountId",
    sub."assetId",
    SUM(sub."size") AS "totalSize"
  FROM (
    SELECT DISTINCT 
      "senderSubaccountId" AS "subaccountId",
      "assetId",
      -"size" AS "size",
      "id"
    FROM 
      "transfers"
    WHERE "transfers"."createdAtHeight" <= ${createdBeforeOrAtHeight}
    UNION 
    SELECT DISTINCT 
      "recipientSubaccountId" AS "subaccountId",
      "assetId",
      "size" AS "size",
      "id"
    FROM 
      "transfers"
    WHERE "transfers"."createdAtHeight" <= ${createdBeforeOrAtHeight}
  ) AS sub
  GROUP BY 
    sub."subaccountId",
    sub."assetId";
  `;
    const result = await (0, stores_helpers_1.rawQuery)(queryString, options);
    const assetsPerSubaccount = result.rows;
    return convertToSubaccountAssetMap(assetsPerSubaccount);
}
exports.getNetTransfersPerSubaccount = getNetTransfersPerSubaccount;
async function create(transferToCreate, options = { txId: undefined }) {
    return transfer_model_1.default.query(transaction_1.default.get(options.txId)).insert({
        id: uuid(transferToCreate.eventId, transferToCreate.assetId, transferToCreate.senderSubaccountId, transferToCreate.recipientSubaccountId, transferToCreate.senderWalletAddress, transferToCreate.recipientWalletAddress),
        ...transferToCreate,
    }).returning('*');
}
exports.create = create;
async function findById(id, options = constants_1.DEFAULT_POSTGRES_OPTIONS) {
    const baseQuery = (0, stores_helpers_1.setupBaseQuery)(transfer_model_1.default, options);
    return baseQuery
        .findById(id)
        .returning('*');
}
exports.findById = findById;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmZXItdGFibGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc3RvcmVzL3RyYW5zZmVyLXRhYmxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLG9EQUF5QjtBQUN6QixvREFBdUI7QUFHdkIsNENBQStFO0FBQy9FLDhEQUltQztBQUNuQyx5RUFBaUQ7QUFDakQsMENBQTBDO0FBQzFDLDhFQUFxRDtBQUNyRCxvQ0FVa0I7QUFFbEIsU0FBZ0IsSUFBSSxDQUNsQixPQUFlLEVBQ2YsT0FBZSxFQUNmLGtCQUEyQixFQUMzQixxQkFBOEIsRUFDOUIsbUJBQTRCLEVBQzVCLHNCQUErQjtJQUUvQixzRUFBc0U7SUFDdEUsT0FBTyxJQUFBLGNBQU8sRUFDWixNQUFNLENBQUMsSUFBSSxDQUNULEdBQUcsa0JBQWtCLElBQUkscUJBQXFCLElBQUksbUJBQW1CLElBQUksc0JBQXNCLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxPQUFPLEVBQUUsRUFDdkksaUNBQXFCLENBQUMsQ0FDekIsQ0FBQztBQUNKLENBQUM7QUFkRCxvQkFjQztBQVFNLEtBQUssVUFBVSxPQUFPLENBQzNCLEVBQ0UsS0FBSyxFQUNMLEVBQUUsRUFDRixrQkFBa0IsRUFDbEIscUJBQXFCLEVBQ3JCLG1CQUFtQixFQUNuQixzQkFBc0IsRUFDdEIsT0FBTyxFQUNQLElBQUksRUFDSixPQUFPLEVBQ1AsZUFBZSxFQUNmLFNBQVMsRUFDVCxlQUFlLEVBQ2YsdUJBQXVCLEVBQ3ZCLGlCQUFpQixFQUNqQixZQUFZLEVBQ1osa0JBQWtCLEdBQ0UsRUFDdEIsY0FBZ0MsRUFDaEMsVUFBbUIsb0NBQXdCO0lBRTNDLElBQUEsd0NBQXVCLEVBQ3JCO1FBQ0UsS0FBSztRQUNMLEVBQUU7UUFDRixrQkFBa0I7UUFDbEIscUJBQXFCO1FBQ3JCLG1CQUFtQjtRQUNuQixzQkFBc0I7UUFDdEIsT0FBTztRQUNQLElBQUk7UUFDSixP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