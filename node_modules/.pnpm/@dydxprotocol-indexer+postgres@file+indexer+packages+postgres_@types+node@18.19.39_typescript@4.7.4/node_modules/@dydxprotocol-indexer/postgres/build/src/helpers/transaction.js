"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const objection_1 = require("objection");
class Transaction {
    static async start() {
        const id = Transaction.nextTxId;
        Transaction.nextTxId += 1;
        Transaction.transactions[id] = await objection_1.Model.startTransaction();
        return id;
    }
    static async setIsolationLevel(id, level) {
        await Transaction.transactions[id].raw(`SET TRANSACTION ISOLATION LEVEL ${level}`);
    }
    static async commit(id) {
        if (!Transaction.transactions[id]) {
            throw new Error('No transaction to commit');
        }
        await Transaction.transactions[id].commit();
        delete Transaction.transactions[id];
    }
    static async rollback(id) {
        if (!Transaction.transactions[id]) {
            throw new Error('No transaction to rollback');
        }
        await Transaction.transactions[id].rollback();
        delete Transaction.transactions[id];
    }
    static get(txId) {
        if (typeof txId === 'number') {
            if (!Transaction.transactions[txId]) {
                throw new Error('No transaction found');
            }
            return Transaction.transactions[txId];
        }
        return undefined;
    }
}
exports.default = Transaction;
Transaction.transactions = {};
Transaction.nextTxId = 1; // Start at non-falsey value.
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNhY3Rpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvaGVscGVycy90cmFuc2FjdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHlDQUE4RDtBQUk5RCxNQUFxQixXQUFXO0lBSXZCLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSztRQUN2QixNQUFNLEVBQUUsR0FBRyxXQUFXLENBQUMsUUFBUSxDQUFDO1FBQ2hDLFdBQVcsQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDO1FBQzFCLFdBQVcsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxpQkFBSyxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDOUQsT0FBTyxFQUFFLENBQUM7SUFDWixDQUFDO0lBRU0sTUFBTSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxFQUFVLEVBQUUsS0FBcUI7UUFDckUsTUFBTSxXQUFXLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxtQ0FBbUMsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUNyRixDQUFDO0lBRU0sTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBVTtRQUNuQyxJQUFJLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsRUFBRTtZQUNqQyxNQUFNLElBQUksS0FBSyxDQUFDLDBCQUEwQixDQUFDLENBQUM7U0FDN0M7UUFDRCxNQUFNLFdBQVcsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDNUMsT0FBTyxXQUFXLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFTSxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxFQUFVO1FBQ3JDLElBQUksQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ2pDLE1BQU0sSUFBSSxLQUFLLENBQUMsNEJBQTRCLENBQUMsQ0FBQztTQUMvQztRQUNELE1BQU0sV0FBVyxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUM5QyxPQUFPLFdBQVcsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVNLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBd0I7UUFDeEMsSUFBSSxPQUFPLElBQUksS0FBSyxRQUFRLEVBQUU7WUFDNUIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ25DLE1BQU0sSUFBSSxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQzthQUN6QztZQUNELE9BQU8sV0FBVyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUN2QztRQUNELE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7O0FBdkNILDhCQXdDQztBQXZDUSx3QkFBWSxHQUFrQyxFQUFFLENBQUM7QUFDakQsb0JBQVEsR0FBVyxDQUFDLENBQUMsQ0FBQyw2QkFBNkIifQ==