{
  "version": 3,
  "sources": [
    "../../node_modules/browser-pack-flat/_prelude",
    "../core/lib/es-utils/assign.js",
    "../core/lib/clone-client.js",
    "../core/lib/extract-object.js",
    "src/request-info.js",
    "src/express.js",
    "../../node_modules/browser-pack-flat/_postlude"
  ],
  "names": [],
  "mappings": "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",
  "file": "generated.js",
  "sourceRoot": "",
  "sourcesContent": [
    "(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.bugsnagExpress = f()}})(function(){var define,module,exports;\n",
    "// extends helper from babel\n// https://github.com/babel/babel/blob/916429b516e6466fd06588ee820e40e025d7f3a3/packages/babel-helpers/src/helpers.js#L377-L393\nmodule.exports = function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i]\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key]\n      }\n    }\n  }\n  return target\n}\n",
    "const assign = require('./es-utils/assign')\n\nconst onCloneCallbacks = []\n\nmodule.exports = (client) => {\n  const clone = new client.Client({}, {}, [], client._notifier)\n\n  clone._config = client._config\n\n  // changes to these properties should not be reflected in the original client,\n  // so ensure they are are (shallow) cloned\n  clone._breadcrumbs = client._breadcrumbs.slice()\n  clone._metadata = assign({}, client._metadata)\n  clone._features = [...client._features]\n  clone._featuresIndex = assign({}, client._featuresIndex)\n  clone._user = assign({}, client._user)\n  clone._context = client._context\n\n  clone._cbs = {\n    e: client._cbs.e.slice(),\n    s: client._cbs.s.slice(),\n    sp: client._cbs.sp.slice(),\n    b: client._cbs.b.slice()\n  }\n\n  clone._logger = client._logger\n  clone._delivery = client._delivery\n  clone._sessionDelegate = client._sessionDelegate\n\n  onCloneCallbacks.forEach(callback => { callback(clone) })\n\n  return clone\n}\n\nmodule.exports.registerCallback = callback => { onCloneCallbacks.push(callback) }\n",
    "// Given a host object, return the value at host[key] if it is an object\n// and it has at least one key/value\n\nmodule.exports = (host, key) => {\n  if (host[key] && typeof host[key] === 'object' && Object.keys(host[key]).length > 0) {\n    return host[key]\n  } else {\n    return undefined\n  }\n}\n",
    "const extractObject = require('@bugsnag/core/lib/extract-object')\n\nmodule.exports = req => {\n  const connection = req.connection\n  const address = connection && connection.address && connection.address()\n  const portNumber = address && address.port\n  const port = (!portNumber || portNumber === 80 || portNumber === 443) ? '' : `:${portNumber}`\n  const protocol = typeof req.protocol !== 'undefined' ? req.protocol : (req.connection.encrypted ? 'https' : 'http')\n  const hostname = (req.hostname || req.host || req.headers.host || '').replace(/:\\d+$/, '')\n  const url = `${protocol}://${hostname}${port}${req.url}`\n  const request = {\n    url: url,\n    path: req.path || req.url,\n    httpMethod: req.method,\n    headers: req.headers,\n    httpVersion: req.httpVersion\n  }\n\n  request.params = extractObject(req, 'params')\n  request.query = extractObject(req, 'query')\n  request.body = extractObject(req, 'body')\n\n  request.clientIp = req.ip || (connection ? connection.remoteAddress : undefined)\n  request.referer = req.headers.referer || req.headers.referrer\n\n  if (connection) {\n    request.connection = {\n      remoteAddress: connection.remoteAddress,\n      remotePort: connection.remotePort,\n      bytesRead: connection.bytesRead,\n      bytesWritten: connection.bytesWritten,\n      localPort: portNumber,\n      localAddress: address ? address.address : undefined,\n      IPVersion: address ? address.family : undefined\n    }\n  }\n  return request\n}\n",
    "/* eslint node/no-deprecated-api: [error, {ignoreModuleItems: [\"domain\"]}] */\nconst domain = require('domain')\nconst extractRequestInfo = require('./request-info')\nconst clone = require('@bugsnag/core/lib/clone-client')\nconst handledState = {\n  severity: 'error',\n  unhandled: true,\n  severityReason: {\n    type: 'unhandledErrorMiddleware',\n    attributes: { framework: 'Express/Connect' }\n  }\n}\n\nmodule.exports = {\n  name: 'express',\n  load: client => {\n    const requestHandler = (req, res, next) => {\n      const dom = domain.create()\n\n      // Get a client to be scoped to this request. If sessions are enabled, use the\n      // resumeSession() call to get a session client, otherwise, clone the existing client.\n      const requestClient = client._config.autoTrackSessions ? client.resumeSession() : clone(client)\n\n      // attach it to the request\n      req.bugsnag = requestClient\n\n      // extract request info and pass it to the relevant bugsnag properties\n      requestClient.addOnError((event) => {\n        const { metadata, request } = getRequestAndMetadataFromReq(req)\n        event.request = { ...event.request, ...request }\n        event.addMetadata('request', metadata)\n      }, true)\n\n      if (!client._config.autoDetectErrors) return next()\n\n      // unhandled errors caused by this request\n      dom.on('error', (err) => {\n        const event = client.Event.create(err, false, handledState, 'express middleware', 1)\n        req.bugsnag._notify(event, () => {}, (e, event) => {\n          if (e) client._logger.error('Failed to send event to Bugsnag')\n          req.bugsnag._config.onUncaughtException(err, event, client._logger)\n        })\n        if (!res.headersSent) {\n          res.statusCode = 500\n          res.end('Internal server error')\n        }\n      })\n\n      return dom.run(next)\n    }\n\n    const errorHandler = (err, req, res, next) => {\n      if (!client._config.autoDetectErrors) return next(err)\n\n      const event = client.Event.create(err, false, handledState, 'express middleware', 1)\n\n      const { metadata, request } = getRequestAndMetadataFromReq(req)\n      event.request = { ...event.request, ...request }\n      event.addMetadata('request', metadata)\n\n      if (req.bugsnag) {\n        req.bugsnag._notify(event)\n      } else {\n        client._logger.warn(\n          'req.bugsnag is not defined. Make sure the @bugsnag/plugin-express requestHandler middleware is added first.'\n        )\n        client._notify(event)\n      }\n\n      next(err)\n    }\n\n    return { requestHandler, errorHandler }\n  }\n}\n\nconst getRequestAndMetadataFromReq = req => {\n  const { body, ...requestInfo } = extractRequestInfo(req)\n  return {\n    metadata: requestInfo,\n    request: {\n      body,\n      clientIp: requestInfo.clientIp,\n      headers: requestInfo.headers,\n      httpMethod: requestInfo.httpMethod,\n      url: requestInfo.url,\n      referer: requestInfo.referer\n    }\n  }\n}\n\nmodule.exports.default = module.exports\n",
    "\nreturn _$express_4;\n\n});\n"
  ]
}